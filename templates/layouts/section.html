{% extends 'layouts/base' %}
{% block title %}{{section_name}}{% endblock %}

{% block content %}

<link href="/static/css/section.css" rel="stylesheet" type="text/css"/>

<main>
    <div class="page-container">
        <div class="gridbody">
            <h1>{{chapter_name}}: {{section_name}}</h1>
            <!-- Information and Image Blocks -->
            <div class = "section" id="sectionText">
                <p>
                    {% for _text in section_text %}

                    <p id="{{_text[0]}}">
                        <strong>Section Block {{_text[0]}}:</strong><br>
                        {{_text[1]}}
                        {% for _image in section_images%}
                            {% if _image[0] == _text[0] %}
                                <br>
                                    <div id="{{_text[0]}} Image">
                                        <p title="{{_image[1]}}" style="text-align: {{_image[2]}}">
                                            <img alt="Section Block {{_text[0]}} Image" src="{{ _image[1] }}">
                                        </p>
                                    </div>
                            {% endif %}
                        {% endfor %}

                    </p>
                    {% endfor %}
                </p>
            </div>

        <!-- Video Block -->
        <div class="videos">
        {% for video in video_files %}
        {% set vid_loop = loop %}
        <video controls class="page_vid" id="video{{vid_loop.index}}">
            <!-- hard coded for now - remember to change -->
            <source src="/static/video/samplevid.mp4" type="video/mp4">
        </video>
        {% endfor %}

        <!-- progress -->
        <div style="text-align:center">
            {% for dot in video_files %}
            {% set dot_loop = loop %}
            <span class="dot" onclick="currentSlide({{dot_loop.index}})"></span>
            {% endfor %}
        </div>

        <!-- navigation -->
        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a class="next" onclick="plusSlides(1)">&#10095;</a>
        </div>

            <!-- Quiz Block -->
            <div>

                <div class="quiz">
                    <h3 class="header" id="header">Section Review!
                        <br>
                        (<span id="quizLength">This review is {{q_list|length}}</span> questions long!)
                        <br>
                        <button class="startBtn" onclick="startQuiz()">Start Quiz</button>
                    </h3>


                    <div class="questions" id="questions">
                        <!-- question grid skeleton -->
                        <div class="question_div">

                            <!-- question progress -->
                            <div class="prog_bub" id="prog_bub">
                                {% for question in q_list %}
                                {% set prog_loop = loop %}
                                <div class="progress" id="progress{{ prog_loop.index-1 }}"></div>
                                {% endfor %}
                            </div>

                            <!-- timer-->
                            <div class="timer_box">
                                <div class="timer_time" id="timer_time">60</div>
                            </div>

                            <!-- for loop question content -->
                            {% for question in q_list %}
                            {% set outer_loop = loop %}
                            <!-- image -->

                            {% set img = question[5] %}
                            <a class="q_img_container" id="q_img_container{{ outer_loop.index-1 }}" data-fancybox
                               href="{{ img }}"><img
                                    class="q_img" src="{{ img }}"></a>

                            <!-- question text -->
                            <div class="q_header" id="q_header{{ outer_loop.index-1 }}">
                                <h4>{{question[1]}}</h4>
                            </div>

                            <!-- question input/answers -->
                            <div class="q_qs" id="q_qs{{ outer_loop.index-1 }}">

                                <!-- short answer -->
                                {% if question[3] == "short" %}
                                <input placeholder="Enter short answer here" type="text" class="input" id="input">

                                <button onclick="submitShortAnswer('{{ a_list[outer_loop.index-1][0][3]}}', this, '{{a_list[outer_loop.index-1][0][4]}}')" class="mult_choice">Submit </button>

                                <!-- multiple choice -->
                                {% else %}
                                {% for answer in a_list[outer_loop.index-1] %}
                                <button class="mult_choice" id="Button{{ answer[0] }}"
                                        onclick="submitMultipleChoiceAnswer('{{answer[2]}}', '{{answer[4]}}', 'Button{{ answer[0] }}', this)">
                                    {{answer[3]}}
                                </button>

                                {% endfor %}
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>

                        <!-- timer-->
                        <div class="timer_box">
                            <div class="timer_time" id="timer_time">60</div>
                        </div>

                        <!-- for loop question content -->
                        {% for question in q_list %}
                        {% set outer_loop = loop %}
                        <!-- image -->

                        <!-- {% set img = question[5] %} -->
                         {% set img = "../static/img/question.png" %}
                        <a class="q_img_container" data-fancybox href="{{ img }}"
                           id="q_img_container{{ outer_loop.index-1 }}"><img
                                class="q_img" src="{{ img }}"></a>

                        <!-- question text -->
                        <div class="q_header" id="q_header{{ outer_loop.index-1 }}">
                            <h4>{{question[1]}}</h4>
                        </div>

                        <!-- question input/answers -->
                        <div class="q_qs" id="q_qs{{ outer_loop.index-1 }}">

                            <!-- short answer -->
                            {% if question[3] == "short" %}
                            <input class="input" id="input" placeholder="Enter short answer here" type="text">

                            <button class="mult_choice" onclick="submitShortAnswer('{{ a_list[outer_loop.index-1][0][3]}}', this, '{{a_list[outer_loop.index-1][0][4]}}')">Submit </button>

                            <!-- multiple choice -->
                            {% else %}
                            {% for answer in a_list[outer_loop.index-1] %}
                            <button class="mult_choice" id="Button{{ answer[0] }}" onclick="submitMultipleChoiceAnswer('{{answer[2]}}', '{{answer[4]}}', 'Button{{ answer[0] }}', this)" >
                                {{answer[3]}}
                            </button>

                            {% endfor %}
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="after" id="after">
                        <button onclick="location.reload()">Redo Quiz?</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="page_nav">
        <!-- If there is a quiz element -->

        <!-- If there is a section after this one -->
        {% if section_id_after != [] %}
            <a href="/section/{{ classID }}/{{ chapter }}/{{ section_id_after}}">
                <button id="next" class="btn btn-primary next-hidden">Next Page</button>
            </a>
            {% else %}
            {% if current_user.has_role_name('Student') %}
            <a href="/student-class-overview/{{ classID }}">
                <button id="next" class="btn btn-primary next-hidden">Back to Class Overview</button>
            </a>
            {% else %}
            <a href="/professor-class-overview/{{ classID }}">
                <button id="next" class="btn btn-primary next-hidden">Back to Class Overview</button>
            </a>
            {% endif %}
        {% endif %}

          <!-- if there isn't a quiz -->
        {% else %}
            <!-- If there is a section after this one -->
            {% if section_id_after != [] %}
            <a href="/section/{{ classID }}/{{ chapter }}/{{ section_id_after}}">
                <button class="btn btn-primary next">Next Page</button>
            </a>

            <!-- If there isn't a section after this one -->
            {% else %}

            <!-- If the user is a student -->
            {% if current_user.has_role_name('Student') %}
            <a href="/student-class-overview/{{ classID }}">
                <button class="btn btn-primary next-hidden">Back to Class Overview</button>
            </a>

            <!-- If the user is a prof -->
            {% else %}
            <a href="/professor-class-overview/{{ classID }}">
                <button class="btn btn-primary next-hidden">Back to Class Overview</button>
            </a>
            {% endif %}
        {% endif %}
        {% endif %}

       <!-- if there exists a section before -->
        {% if section_id_before != [] %}
        <a href="/section/{{ classID }}/{{ chapter }}/{{ section_id_before}}">
            <button class="btn btn-primary previous">Previous Page</button>
        </a>

        <!-- if there isn't a section before -->
        {% else %}
             <!-- If the user is a student -->
            {% if current_user.has_role_name('Student') %}
            <a href="/student-class-overview/{{ classID }}">
                <button class="btn btn-primary previous">Back to Class Overview</button>
            </a>

            <!-- If the user is a prof -->
            {% else %}
            <a href="/professor-class-overview/{{ classID }}">
                <button class="btn btn-primary previous">Back to Class Overview</button>
            </a>
            {% endif %}
        {% endif %}
        </div>
    </div>
</main>
<script src="/static/js/section.js"></script>
{% endblock %}

<!--
    display: grid;
    grid-template-columns:[one]20% [two]70% [three]10%;
    grid-template-rows: [top]minmax(50%, auto) [top]minmax(50%, auto);
-->
